---
title: FastDFS æ–‡ä»¶æœåŠ¡å™¨é—®é¢˜è§£å†³æŒ‡å—
date: '2025-07-16'
tags: ['tip']
draft: false
summary:
---

FastDFS æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ’æŸ¥å’Œä¿®å¤ã€‚

---

## ğŸ” **1. æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€**

é¦–å…ˆæŸ¥çœ‹ `storage` å’Œ `tracker` å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

```bash
docker container ls
```

ğŸ“Œ **å¦‚æœå®¹å™¨æ²¡æœ‰è¿è¡Œ**ï¼ŒæŒ‰é¡ºåºå¯åŠ¨å®ƒä»¬ï¼ˆ**å…ˆå¯åŠ¨ `tracker`**ï¼‰ï¼š

```bash
docker start tracker
docker start storage
```

---

## âš™ï¸ **2. æ£€æŸ¥ FastDFS å’Œ Nginx æœåŠ¡**

å¦‚æœå®¹å™¨å·²è¿è¡Œï¼Œä½†æ–‡ä»¶è®¿é—®ä»ç„¶å¼‚å¸¸ï¼Œå¯èƒ½æ˜¯æœåŠ¡æœªå¯åŠ¨ã€‚

### **è¿›å…¥ `tracker` å®¹å™¨æ£€æŸ¥æœåŠ¡**

```bash
docker exec -it tracker bash
ps -ef | grep fdfs  # æŸ¥çœ‹ FastDFS è¿›ç¨‹
/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start  # é‡å¯ tracker æœåŠ¡
```

### **è¿›å…¥ `storage` å®¹å™¨æ£€æŸ¥æœåŠ¡**

```bash
docker exec -it storage bash
ps -ef | grep fdfs  # æŸ¥çœ‹ FastDFS è¿›ç¨‹
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start  # é‡å¯ storage æœåŠ¡

# æ£€æŸ¥ Nginx æ˜¯å¦è¿è¡Œ
ps -ef | grep nginx
kill -9 <åŸNginxè¿›ç¨‹ID>  # å¼ºåˆ¶åœæ­¢æ—§è¿›ç¨‹ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰
/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf  # å¯åŠ¨ Nginx
```

å¦‚æœæ–‡ä»¶è®¿é—®è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æŒ‚è½½æƒ…å†µ

## ğŸ“‚ **3. æ£€æŸ¥æŒ‚è½½æƒ…å†µ**

FastDFS ä¾èµ–å®¿ä¸»æœºå’Œå®¹å™¨çš„æ–‡ä»¶æŒ‚è½½ï¼Œç¡®ä¿æ•°æ®åŒæ­¥ã€‚

### **æŸ¥çœ‹ `storage` å®¹å™¨çš„æŒ‚è½½ä¿¡æ¯**

```bash
docker inspect storage | grep -A 50 Mounts
```

ç¤ºä¾‹è¾“å‡ºï¼š

```bash
            {
                "Type": "bind",
                "Source": "/var/fdfs/storage",
                "Destination": "/var/fdfs",
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            },
            {
                "Type": "bind",
                "Source": "/var/fdfs2/storage",
                "Destination": "/var/fdfs2",
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            },
            {
                "Type": "bind",
                "Source": "/fdfs2/storage",
                "Destination": "/var/fdfs3",
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            }
```

- **`Source`**: å®¿ä¸»æœºè·¯å¾„ï¼ˆå¦‚ `/var/fdfs/storage`ï¼‰
- **`Destination`**: å®¹å™¨å†…è·¯å¾„ï¼ˆå¦‚ `/var/fdfs`ï¼‰

ğŸ“Œ **å¦‚æœ `Source` è·¯å¾„æ²¡æœ‰æ•°æ®**ï¼Œå¯èƒ½æ˜¯æŒ‚è½½æˆ–è½¯é“¾æ¥é—®é¢˜ã€‚

---

## ğŸ”— **4. æ£€æŸ¥è½¯é“¾æ¥å’Œç£ç›˜æŒ‚è½½**

FastDFS å¯èƒ½ä½¿ç”¨**è½¯é“¾æ¥**æŒ‡å‘å®é™…å­˜å‚¨è·¯å¾„ï¼Œä¾‹å¦‚ï¼š

```bash
ls -l /var
```

è¾“å‡ºç¤ºä¾‹ï¼š

```bash
lrwxrwxrwx 1 root root 14 Jun  6 10:48 fdfs -> /data/fdfs/fdfs/
```

è¿™æ„å‘³ç€ `/var/fdfs` å®é™…æŒ‡å‘ `/data/fdfs/fdfs/`ã€‚

è€Œ`/data/fdfs`ç›®å½•æœ‰å¯èƒ½æŒ‚è½½åˆ°äº†æŸä¸ªæ‰©å®¹ç£ç›˜

### **æ£€æŸ¥ç£ç›˜æŒ‚è½½**

```bash
lsblk
```

ğŸ“Œ **å¦‚æœæŒ‚è½½ä¸¢å¤±**ï¼Œæ‰‹åŠ¨æŒ‚è½½ï¼š

```bash
mount /dev/vdc1 /data/fdfs
mount /dev/vdc2 /data/fdfs1
mount /dev/vdd1 /data/fdfs2
```

### **ä¿®å¤è½¯é“¾æ¥ï¼ˆå¦‚æœç¼ºå¤±ï¼‰**

```
ln -s /data/fdfs/fdfs/ /var/fdfs
ln -s /data/fdfs1/ /var/fdfs2
ln -s /data/fdfs2/ /fdfs2
```

---

## ğŸ”„ **5. é‡å¯ Docker å®¹å™¨**

ä¿®å¤æŒ‚è½½åï¼Œé‡å¯å®¹å™¨ï¼š

```bash
docker restart tracker
docker restart storage
```

---

## âœ… 6. **æµ‹è¯•**

çœ‹çœ‹dockerå®¹å™¨ä¸­æ˜¯å¦å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œè¯´æ˜é—®é¢˜è§£å†³

æ¯”å¦‚ï¼š

```bash
docker exec -it storage ls /var/fdfs/data/02/05/
```

å¸Œæœ›è¿™ç¯‡æŒ‡å—èƒ½å¸®ä½ è§£å†³é—®é¢˜ï¼ğŸš€ ğŸ‰
